<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Cameras</title>
        <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
        <style type="text/css">
            video.camera_feed {
                width: 33%;
            }
        </style>
    </head>
    <body>
        <div>
            {% for camera_id in camera_ids %}
                <video controls autoplay muted class="camera_feed" id="{{ camera_id }}" src="{{ camera_id }}.m3u8"></video>
            {% endfor %}
        </div>
        <script>
            function setupCameraFeed(video) {
                if (video.canPlayType('application/vnd.apple.mpegurl')) {
                    console.log("HLS Native support")
                    video.play();
                } else if (Hls.isSupported()) {
                    console.log("using hls.js MSE support")
                    var hls = new Hls();
                    hls.loadSource(video.src);
                    hls.attachMedia(video);
                    hls.on(Hls.Events.MANIFEST_PARSED, function() {
                        video.play();
                    });
                } else {
                    console.log("nothing supported, give up")
                }
            }
            var camera_feeds = document.getElementsByTagName('video')
            for (let i=0;i<camera_feeds.length;i++) {
                fixCameraFeed(camera_feeds[i])
            }
        </script>
    </body>
</html>
